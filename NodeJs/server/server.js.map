{"version":3,"sources":["server/server.ts"],"names":[],"mappings":"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","file":"server.js","sourcesContent":["var http = require(\"http\"); \nvar CryptoJS = require(\"crypto-js\"); \nvar config = require('config');\nvar ws = require(\"nodejs-websocket\");\n\n \ninterface SUDModel { \n    name: string;  \n}\n\nlet Data = Array<SUDModel>();\n \n\nvar WSServer = ws.createServer(function (conn) {\n    conn.sendText(JSON.stringify(Data));\n}).listen(8001)\n\nfunction AddNewData(data) {\n    Data.push(data);\n    WSServer.connections.forEach(function (conn) {\n        conn.sendText(JSON.stringify(Data));\n    })\n}\n\n\nvar KnowSources =  config.get('KnowSources');\n \nvar port =  7878\nhttp.createServer(function (req, res) {\n\n\n    if (req.method == 'POST' && req.url == '/localexchange/endpoint' && req.headers[\"content-type\"] == \"application/jose\") { \n        if (!req.headers[\"x-seneye\"]) {\n            res.writeHead(400);\n            res.end();\n            return;\n        } \n        let currSource = KnowSources.find(o=>o.source == req.headers[\"x-seneye\"]); \n        if (!currSource) {\n            res.writeHead(404);\n            res.end();\n            return;\n        } \n        req.setEncoding('utf8');\n        var body: string[];\n\n        body = new Array<string>();\n\n        req.on('data', function (chunk) {\n            body.push(chunk);\n        }).on('end', function () {\n            var r: string[];\n            var isValid: boolean = false;\n\n            r = (body.join()).split(\".\");\n            if (r.length == 3) {\n\n                if (r[0] == \"eyJhbGciOiJIUzI1NiJ9\") {\n                    var sign = CryptoJS.HmacSHA256(r[0] + \".\" + r[1],  currSource.secret);\n                    var psign = CryptoJS.enc.Base64.parse(r[2]);\n\n                    if (sign.toString() == psign.toString()) {\n                        console.log(\"ok :)\");\n                        isValid = true;\n                        var buf = Buffer.from(r[1], 'base64'); \n                        var d = JSON.parse(buf.toString()); \n                        AddNewData(d.SUD); \n                    } \n                }\n            } \n            if (isValid) {\n                res.writeHead(200);\n            }\n            else {\n                res.writeHead(400);\n            }\n            res.end();\n        })\n    }\n    else {\n        res.writeHead(404);\n        res.end();\n    }\n    \n}).listen(port);\n\n"],"sourceRoot":"c:\\xseneyex\\LocalDataExchange\\NodeJs"}